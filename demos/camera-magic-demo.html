<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“¸ Camera Magic Modal Demo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+TC:wght@400;500;700&display=swap"
        rel="stylesheet">
    <style>
        /* === Root & Reset === */
        :root {
            --bg-primary: #0a0a0f;
            --bg-card: #141420;
            --bg-section: #1a1a2e;
            --accent-cyan: #22d3ee;
            --accent-purple: #a855f7;
            --accent-blue: #6366f1;
            --accent-pink: #ec4899;
            --accent-gold: #fbbf24;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --glass-bg: rgba(20, 20, 32, 0.85);
            --glass-border: rgba(139, 92, 246, 0.25);
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* === Demo Page Layout === */
        .demo-page {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .demo-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .demo-header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .demo-header p {
            color: var(--text-secondary);
            font-size: .9rem;
        }

        .demo-trigger-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 32px;
            font-size: 1rem;
            font-weight: 700;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            color: #fff;
            background: linear-gradient(135deg, #6366f1, #a855f7, #ec4899);
            box-shadow: 0 0 30px rgba(139, 92, 246, .4);
            transition: all .3s;
            margin-top: 20px;
        }

        .demo-trigger-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 0 50px rgba(139, 92, 246, .6);
        }

        .demo-output {
            margin-top: 30px;
            background: var(--bg-section);
            border: 1px solid var(--glass-border);
            border-radius: 14px;
            padding: 20px;
            min-height: 80px;
        }

        .demo-output-label {
            font-size: .75rem;
            color: var(--accent-cyan);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .demo-output-text {
            font-family: 'Fira Code', monospace;
            font-size: .85rem;
            color: var(--text-primary);
            line-height: 1.7;
            word-break: break-all;
        }

        .demo-output-text .highlight {
            color: var(--accent-gold);
            font-weight: 600;
        }

        .demo-output-text .bonus {
            color: var(--accent-cyan);
        }

        /* === Modal Overlay === */
        .cmm-overlay {
            position: fixed;
            inset: 0;
            z-index: 10000;
            background: rgba(0, 0, 0, .88);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: cmm-fadeIn .4s ease;
            backdrop-filter: blur(6px);
        }

        .cmm-overlay.closing {
            animation: cmm-fadeOut .3s ease forwards;
        }

        /* === Particles === */
        .cmm-particles {
            position: absolute;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .cmm-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: cmm-float 6s ease-in-out infinite;
        }

        /* === Magic Circle === */
        .cmm-magic-circle {
            position: absolute;
            width: 600px;
            height: 600px;
            border-radius: 50%;
            border: 1px solid rgba(99, 102, 241, .15);
            animation: cmm-rotate 20s linear infinite;
            z-index: 0;
            pointer-events: none;
        }

        .cmm-magic-circle::before {
            content: 'âœ¦ CAMERA âœ¦ MAGIC âœ¦ LENS âœ¦ ANGLE âœ¦';
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            letter-spacing: 18px;
            color: rgba(139, 92, 246, .2);
        }

        /* === Container === */
        .cmm-container {
            position: relative;
            z-index: 2;
            width: 92vw;
            max-width: 860px;
            height: 72vh;
            max-height: 680px;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, rgba(15, 15, 30, .97), rgba(25, 15, 40, .97));
            border: 1px solid rgba(139, 92, 246, .3);
            border-radius: 20px;
            box-shadow: 0 0 80px rgba(99, 102, 241, .2), 0 0 40px rgba(139, 92, 246, .15);
            overflow: hidden;
            animation: cmm-slideUp .5s cubic-bezier(.16, 1, .3, 1);
        }

        /* === Flash === */
        .cmm-flash {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, rgba(139, 92, 246, .4) 0%, transparent 70%);
            z-index: 1;
            pointer-events: none;
            animation: cmm-flashPulse .6s ease-out forwards;
        }

        /* === Header === */
        .cmm-header {
            padding: 16px 20px 0;
            flex-shrink: 0;
        }

        .cmm-title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .cmm-title {
            font-size: 1.3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .cmm-toolbar {
            display: flex;
            gap: 8px;
        }

        .cmm-toolbar button {
            background: rgba(139, 92, 246, .15);
            border: 1px solid rgba(139, 92, 246, .3);
            color: var(--text-primary);
            border-radius: 8px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: .8rem;
            transition: all .2s;
        }

        .cmm-toolbar button:hover {
            background: rgba(139, 92, 246, .3);
            transform: scale(1.05);
        }

        /* === Search === */
        .cmm-search-row {
            position: relative;
            margin-bottom: 8px;
        }

        .cmm-search-row input {
            width: 100%;
            padding: 10px 14px 10px 36px;
            background: rgba(30, 30, 50, .8);
            border: 1px solid rgba(139, 92, 246, .2);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: .85rem;
            outline: none;
            transition: border-color .2s;
        }

        .cmm-search-row input:focus {
            border-color: var(--accent-purple);
            box-shadow: 0 0 15px rgba(139, 92, 246, .2);
        }

        .cmm-search-row i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: .85rem;
        }

        /* === Tabs === */
        .cmm-tabs {
            display: flex;
            gap: 3px;
            padding: 0 20px;
            overflow-x: auto;
            flex-shrink: 0;
            scrollbar-width: none;
        }

        .cmm-tabs::-webkit-scrollbar {
            display: none;
        }

        .cmm-tab {
            padding: 7px 12px;
            font-size: .72rem;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            white-space: nowrap;
            color: var(--text-secondary);
            background: rgba(30, 30, 50, .5);
            border: 1px solid transparent;
            border-bottom: none;
            transition: all .2s;
            flex-shrink: 0;
        }

        .cmm-tab:hover {
            color: var(--text-primary);
            background: rgba(139, 92, 246, .1);
        }

        .cmm-tab.active {
            color: var(--accent-cyan);
            background: rgba(139, 92, 246, .15);
            border-color: rgba(139, 92, 246, .3);
            font-weight: 600;
        }

        /* === Body === */
        .cmm-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px 20px;
            scrollbar-width: thin;
            scrollbar-color: rgba(139, 92, 246, .3) transparent;
        }

        .cmm-body::-webkit-scrollbar {
            width: 6px;
        }

        .cmm-body::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, .3);
            border-radius: 3px;
        }

        /* === Grid === */
        .cmm-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 8px;
        }

        /* === Chip === */
        .cmm-chip {
            padding: 9px 11px;
            font-size: .73rem;
            border-radius: 10px;
            cursor: pointer;
            background: rgba(30, 30, 50, .6);
            border: 1px solid rgba(100, 100, 150, .2);
            color: var(--text-secondary);
            transition: all .25s;
            display: flex;
            align-items: center;
            gap: 6px;
            position: relative;
            overflow: hidden;
        }

        .cmm-chip::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(99, 102, 241, .08), rgba(139, 92, 246, .08));
            opacity: 0;
            transition: opacity .25s;
        }

        .cmm-chip:hover {
            border-color: rgba(139, 92, 246, .4);
            color: var(--text-primary);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, .15);
        }

        .cmm-chip:hover::before {
            opacity: 1;
        }

        .cmm-chip.selected {
            background: linear-gradient(135deg, rgba(99, 102, 241, .25), rgba(139, 92, 246, .2));
            border-color: var(--accent-purple);
            color: #fff;
            box-shadow: 0 0 20px rgba(139, 92, 246, .25);
        }

        .cmm-chip.selected::after {
            content: 'âœ“';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: .7rem;
            color: var(--accent-cyan);
            font-weight: 700;
        }

        .cmm-chip-icon {
            font-size: 1rem;
            flex-shrink: 0;
        }

        .cmm-chip-text {
            display: flex;
            flex-direction: column;
            gap: 1px;
            z-index: 1;
        }

        .cmm-chip-zh {
            font-weight: 600;
            font-size: .75rem;
        }

        .cmm-chip-en {
            font-size: .62rem;
            opacity: .6;
        }

        /* === Bonus Panel === */
        .cmm-bonus {
            flex-shrink: 0;
            padding: 10px 20px;
            border-top: 1px solid rgba(139, 92, 246, .2);
            background: rgba(20, 15, 30, .6);
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: all .4s ease;
        }

        .cmm-bonus.visible {
            max-height: 180px;
            opacity: 1;
            padding: 14px 20px;
        }

        .cmm-bonus-title {
            font-size: .75rem;
            color: var(--accent-gold);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .cmm-bonus-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .cmm-bonus-tag {
            padding: 5px 10px;
            font-size: .7rem;
            border-radius: 20px;
            cursor: pointer;
            background: rgba(251, 191, 36, .08);
            border: 1px solid rgba(251, 191, 36, .2);
            color: rgba(251, 191, 36, .8);
            transition: all .2s;
        }

        .cmm-bonus-tag:hover {
            background: rgba(251, 191, 36, .15);
            border-color: rgba(251, 191, 36, .4);
            color: var(--accent-gold);
        }

        .cmm-bonus-tag.selected {
            background: rgba(251, 191, 36, .2);
            border-color: var(--accent-gold);
            color: var(--accent-gold);
            font-weight: 600;
            box-shadow: 0 0 12px rgba(251, 191, 36, .2);
        }

        /* === Empty State === */
        .cmm-empty {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
            font-size: .85rem;
        }

        /* === Footer === */
        .cmm-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            border-top: 1px solid rgba(139, 92, 246, .15);
            background: rgba(10, 10, 20, .5);
            flex-shrink: 0;
        }

        .cmm-footer-status {
            font-size: .75rem;
            color: var(--text-secondary);
        }

        .cmm-footer-status .count {
            color: var(--accent-cyan);
            font-weight: 700;
        }

        .cmm-footer-actions {
            display: flex;
            gap: 8px;
        }

        .cmm-btn {
            padding: 8px 20px;
            font-size: .8rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            border: none;
            transition: all .2s;
        }

        .cmm-btn-cancel {
            background: rgba(100, 100, 150, .2);
            color: var(--text-secondary);
            border: 1px solid rgba(100, 100, 150, .2);
        }

        .cmm-btn-cancel:hover {
            background: rgba(100, 100, 150, .3);
            color: var(--text-primary);
        }

        .cmm-btn-apply {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: #fff;
            box-shadow: 0 0 20px rgba(99, 102, 241, .3);
        }

        .cmm-btn-apply:hover {
            transform: translateY(-1px);
            box-shadow: 0 0 30px rgba(99, 102, 241, .5);
        }

        .cmm-btn-clear {
            background: rgba(239, 68, 68, .12);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, .2);
        }

        .cmm-btn-clear:hover {
            background: rgba(239, 68, 68, .2);
        }

        /* === Dice overlay === */
        .cmm-dice-overlay {
            position: absolute;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, .7);
            z-index: 99;
            border-radius: 20px;
        }

        .cmm-dice-overlay.active {
            display: flex;
        }

        .cmm-dice-icon {
            font-size: 4rem;
            animation: cmm-diceRoll .8s ease-in-out;
        }

        /* === Animations === */
        @keyframes cmm-fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes cmm-fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        @keyframes cmm-slideUp {
            from {
                opacity: 0;
                transform: translateY(40px) scale(.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes cmm-flashPulse {
            0% {
                opacity: .6;
            }

            100% {
                opacity: 0;
            }
        }

        @keyframes cmm-rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @keyframes cmm-float {

            0%,
            100% {
                transform: translateY(0) translateX(0);
                opacity: .3;
            }

            50% {
                transform: translateY(-100px) translateX(30px);
                opacity: .8;
            }
        }

        @keyframes cmm-diceRoll {
            0% {
                transform: rotate(0deg) scale(1);
            }

            25% {
                transform: rotate(180deg) scale(1.3);
            }

            50% {
                transform: rotate(360deg) scale(1);
            }

            75% {
                transform: rotate(540deg) scale(1.2);
            }

            100% {
                transform: rotate(720deg) scale(1);
            }
        }

        @keyframes cmm-chipPop {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.08);
            }

            100% {
                transform: scale(1);
            }
        }

        /* === Summary bar (on demo page) === */
        .demo-summary {
            margin-top: 16px;
            padding: 14px 18px;
            background: linear-gradient(135deg, rgba(99, 102, 241, .1), rgba(139, 92, 246, .08));
            border: 1px solid rgba(139, 92, 246, .3);
            border-radius: 12px;
            display: none;
        }

        .demo-summary.visible {
            display: block;
        }

        .demo-summary-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .demo-summary-title {
            font-size: .85rem;
            font-weight: 700;
            color: var(--accent-cyan);
        }

        .demo-summary-clear {
            font-size: .72rem;
            padding: 4px 10px;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid rgba(239, 68, 68, .3);
            background: rgba(239, 68, 68, .1);
            color: #f87171;
            transition: all .2s;
        }

        .demo-summary-clear:hover {
            background: rgba(239, 68, 68, .2);
        }

        .demo-summary-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .demo-summary-tag {
            padding: 4px 10px;
            font-size: .7rem;
            border-radius: 16px;
            font-weight: 600;
        }

        .demo-summary-tag.main {
            background: rgba(139, 92, 246, .2);
            border: 1px solid var(--accent-purple);
            color: var(--accent-purple);
        }

        .demo-summary-tag.bonus {
            background: rgba(251, 191, 36, .12);
            border: 1px solid rgba(251, 191, 36, .3);
            color: var(--accent-gold);
        }
    </style>
</head>

<body>
    <div class="demo-page">
        <div class="demo-header">
            <h1>ğŸ“¸ Camera Magic Modal â€” Demo</h1>
            <p>åŸºæ–¼ camera-work-prompt-guide.md çš„é€²éšé‹é¡é¸æ“‡å™¨</p>
            <button class="demo-trigger-btn" onclick="openCameraModal()">
                <i class="fa-solid fa-wand-sparkles"></i>
                ğŸ“¸ é–‹å•Ÿé‹é¡é­”æ³•
            </button>
        </div>

        <div class="demo-summary" id="demoSummary">
            <div class="demo-summary-header">
                <span class="demo-summary-title">ğŸ“¸ é‹é¡é­”æ³•å•Ÿç”¨ä¸­</span>
                <button class="demo-summary-clear" onclick="clearAll()">æ¸…é™¤</button>
            </div>
            <div class="demo-summary-tags" id="demoSummaryTags"></div>
        </div>

        <div class="demo-output">
            <div class="demo-output-label">âš¡ Generated Camera Prompt</div>
            <div class="demo-output-text" id="outputText">
                <span style="color: var(--text-secondary)">é»æ“Šä¸Šæ–¹æŒ‰éˆ•ï¼Œé¸æ“‡é‹é¡æŠ€å·§â€¦</span>
            </div>
        </div>
    </div>

    <script>
        // ================================================
        // Camera Magic Dataï¼ˆèƒå–è‡ª camera-work-prompt-guide.mdï¼‰
        // ================================================
        const CAMERA_DATA = {
            TABS: [
                { id: 'all', label: 'å…¨éƒ¨', en: 'All', icon: 'âœ¨' },
                { id: 'recent', label: 'æœ€è¿‘', en: 'Recent', icon: 'ğŸ•' },
                { id: 'hot', label: 'ç†±é–€', en: 'Hot', icon: 'ğŸ”¥' },
                { id: 'distance', label: 'é¡é ­è·é›¢', en: 'Distance', icon: 'ğŸ“' },
                { id: 'vAngle', label: 'å‚ç›´è§’åº¦', en: 'V-Angle', icon: 'ğŸ“' },
                { id: 'hAngle', label: 'æ°´å¹³è§’åº¦', en: 'H-Angle', icon: 'ğŸ”„' },
                { id: 'movement', label: 'é¡é ­é‹å‹•', en: 'Movement', icon: 'ğŸ¥' },
                { id: 'lens', label: 'é¡é ­ç„¦è·', en: 'Lens', icon: 'ğŸ”­' },
                { id: 'dof', label: 'æ™¯æ·±å°ç„¦', en: 'DOF', icon: 'ğŸ¯' },
                { id: 'composition', label: 'æ§‹åœ–æŠ€å·§', en: 'Compose', icon: 'ğŸ–¼ï¸' }
            ],

            HOT_ITEMS: [
                'cu', 'ms', 'fs', 'low_angle', 'birdeye', 'three_quarter', 'dutch',
                'tracking', 'lens_85', 'shallow_dof', 'rule_thirds', 'frame_in_frame',
                'mcu', 'ews', 'profile', 'dolly_in', 'lens_50', 'bokeh', 'pov', 'cowboy'
            ],

            ITEMS: [
                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                // ğŸ“ é¡é ­è·é›¢ (distance) â€” 9 items
                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                { id: 'ecu', label: 'å¤§ç‰¹å¯«', en: 'Extreme Close-Up', value: 'extreme close-up, macro detail, partial face visible', category: 'distance', icon: 'ğŸ”¬' },
                { id: 'cu', label: 'ç‰¹å¯«', en: 'Close-Up', value: 'close-up portrait, head and shoulders framing', category: 'distance', icon: 'ğŸ‘¤' },
                { id: 'mcu', label: 'ä¸­ç‰¹å¯«', en: 'Medium Close-Up', value: 'medium close-up, framed from chest up, bust shot', category: 'distance', icon: 'ğŸ‘•' },
                { id: 'ms', label: 'ä¸­æ™¯', en: 'Medium Shot', value: 'medium shot, waist-up shot, hands visible', category: 'distance', icon: 'ğŸ§' },
                { id: 'mls', label: 'ä¸­é æ™¯', en: 'Medium Long Shot', value: 'medium long shot, framed from knees up, American shot', category: 'distance', icon: 'ğŸš¶' },
                { id: 'cowboy', label: 'ç‰›ä»”é¡é ­', en: 'Cowboy Shot', value: 'cowboy shot, mid-thigh framing', category: 'distance', icon: 'ğŸ¤ ' },
                { id: 'fs', label: 'å…¨èº«é¡é ­', en: 'Full Shot', value: 'full body shot, head to toe, feet visible', category: 'distance', icon: 'ğŸ§â€â™‚ï¸' },
                { id: 'ws', label: 'é æ™¯', en: 'Wide Shot', value: 'wide shot, character is small in the frame, environment-dominant composition', category: 'distance', icon: 'ğŸï¸' },
                { id: 'ews', label: 'å¤§é æ™¯', en: 'Extreme Wide Shot', value: 'extreme wide shot, tiny figure in vast landscape, dwarfed by the environment', category: 'distance', icon: 'ğŸŒ' },

                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                // ğŸ“ å‚ç›´è§’åº¦ (vAngle) â€” 6 items
                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                { id: 'eye_level', label: 'å¹³è¦–', en: 'Eye-Level', value: 'eye-level shot, neutral angle', category: 'vAngle', icon: 'ğŸ‘ï¸' },
                { id: 'low_angle', label: 'ä»°è§’', en: 'Low Angle', value: 'dramatic low angle shot, looking up at, shot from below', category: 'vAngle', icon: 'â¬†ï¸' },
                { id: 'high_angle', label: 'ä¿¯è§’', en: 'High Angle', value: 'high angle shot, looking down at, shot from above', category: 'vAngle', icon: 'â¬‡ï¸' },
                { id: 'birdeye', label: 'é³¥ç°', en: "Bird's-Eye View", value: "bird's-eye view, overhead shot, top-down view, aerial view", category: 'vAngle', icon: 'ğŸ¦…' },
                { id: 'wormseye', label: 'èŸ²è¦–', en: "Worm's-Eye View", value: "worm's-eye view, ultra low angle, looking straight up", category: 'vAngle', icon: 'ğŸ›' },
                { id: 'ground_level', label: 'åœ°é¢è¦–è§’', en: 'Ground-Level', value: 'ground-level shot, camera on the ground', category: 'vAngle', icon: 'ğŸŒ¿' },

                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                // ğŸ”„ æ°´å¹³è§’åº¦ (hAngle) â€” 7 items
                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                { id: 'front_view', label: 'æ­£é¢', en: 'Front View', value: 'front view, facing the camera, looking at viewer', category: 'hAngle', icon: 'ğŸ¯' },
                { id: 'three_quarter', label: 'å››åˆ†ä¹‹ä¸‰è§’', en: 'Three-Quarter', value: 'three-quarter view, face turned about 30-45 degrees', category: 'hAngle', icon: 'â†—ï¸' },
                { id: 'profile', label: 'å´é¢', en: 'Profile View', value: 'profile view, perfect profile, showing one eye only', category: 'hAngle', icon: 'ğŸ‘¤' },
                { id: 'back_view', label: 'èƒŒé¢', en: 'Back View', value: 'back view, from behind, face not shown, facing away from camera', category: 'hAngle', icon: 'ğŸ”™' },
                { id: 'dutch', label: 'è·è˜­è§’', en: 'Dutch Angle', value: 'Dutch angle, strongly tilted about 20-30 degrees, canted angle', category: 'hAngle', icon: 'ğŸ“' },
                { id: 'ots', label: 'éè‚©é¡é ­', en: 'Over-the-Shoulder', value: 'over-the-shoulder shot, shallow depth of field focusing on the distant subject', category: 'hAngle', icon: 'ğŸ™‹' },
                { id: 'pov', label: 'ç¬¬ä¸€äººç¨±', en: 'POV Shot', value: "POV shot, first-person perspective, character's hands visible", category: 'hAngle', icon: 'ğŸ®' },

                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                // ğŸ¥ é¡é ­é‹å‹• (movement) â€” 8 items
                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                { id: 'dolly_in', label: 'æ¨é€²', en: 'Dolly-In', value: 'dolly-in, push-in, camera moving toward subject, shallow depth of field', category: 'movement', icon: 'â¡ï¸' },
                { id: 'dolly_out', label: 'æ‹‰é ', en: 'Dolly-Out', value: 'dolly-out, pull-back, reveal shot, character small in frame', category: 'movement', icon: 'â¬…ï¸' },
                { id: 'orbit', label: 'ç’°ç¹', en: 'Orbit Shot', value: 'orbit shot, camera orbiting around, slight motion blur in background', category: 'movement', icon: 'ğŸ”„' },
                { id: 'crane', label: 'èµ·é‡æ©Ÿ', en: 'Crane Shot', value: 'crane shot, sweeping overhead, camera rising above', category: 'movement', icon: 'ğŸ—ï¸' },
                { id: 'handheld', label: 'æ‰‹æŒ', en: 'Handheld', value: 'handheld camera, documentary style, film grain, slightly off-center framing', category: 'movement', icon: 'âœ‹' },
                { id: 'tracking', label: 'è¿½è¹¤', en: 'Tracking Shot', value: 'tracking shot, camera following subject, motion blur in background, subject sharp', category: 'movement', icon: 'ğŸƒ' },
                { id: 'whip_pan', label: 'ç”©é¡', en: 'Whip Pan', value: 'whip pan, speed blur, swish pan', category: 'movement', icon: 'ğŸ’¨' },
                { id: 'pan_tilt', label: 'æ–é¡/å‚¾æ–œ', en: 'Pan & Tilt', value: 'panning shot, panoramic composition', category: 'movement', icon: 'â†”ï¸' },

                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                // ğŸ”­ é¡é ­ç„¦è· (lens) â€” 8 items
                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                { id: 'lens_fisheye', label: 'é­šçœ¼ 8-16mm', en: 'Fisheye', value: 'fisheye lens, 180 degrees, barrel distortion', category: 'lens', icon: 'ğŸŸ' },
                { id: 'lens_14', label: 'è¶…å»£è§’ 14-24mm', en: 'Ultra-Wide', value: '14mm ultra-wide angle lens, strong perspective, exaggerated space', category: 'lens', icon: 'ğŸŒ' },
                { id: 'lens_35', label: 'å»£è§’ 24-35mm', en: 'Wide Angle', value: '35mm wide-angle lens, natural but wide, street photography', category: 'lens', icon: 'ğŸ“¸' },
                { id: 'lens_50', label: 'æ¨™æº– 50mm', en: 'Nifty Fifty', value: '50mm lens, closest to human eye, natural perspective', category: 'lens', icon: 'ğŸ‘ï¸' },
                { id: 'lens_85', label: 'äººåƒ 85mm', en: '85mm Portrait', value: '85mm portrait lens, beautiful face compression, creamy bokeh', category: 'lens', icon: 'ğŸ–¼ï¸' },
                { id: 'lens_135', label: 'ä¸­æœ›é  135mm', en: '135mm Tele', value: '135mm lens, beautiful compression, strong bokeh', category: 'lens', icon: 'ğŸ”­' },
                { id: 'lens_200', label: 'æœ›é  200mm+', en: '200mm Telephoto', value: '200mm telephoto lens, extreme compression, tunnel effect', category: 'lens', icon: 'ğŸ”¬' },
                { id: 'lens_macro', label: 'å¾®è·', en: 'Macro', value: 'macro lens, 1:1 macro, extreme detail, paper-thin depth of field', category: 'lens', icon: 'ğŸ”' },

                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                // ğŸ¯ æ™¯æ·±å°ç„¦ (dof) â€” 8 items
                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                { id: 'shallow_dof', label: 'æ·ºæ™¯æ·±', en: 'Shallow DOF', value: 'shallow depth of field, bokeh, f/1.8', category: 'dof', icon: 'ğŸŒ¸' },
                { id: 'ultra_shallow', label: 'æ¥µæ·ºæ™¯æ·±', en: 'Ultra Shallow', value: 'paper-thin depth of field, only eyes in focus, f/1.2', category: 'dof', icon: 'ğŸ’«' },
                { id: 'deep_focus', label: 'æ·±æ™¯æ·±', en: 'Deep Focus', value: 'deep focus, everything sharp, f/11', category: 'dof', icon: 'ğŸ”­' },
                { id: 'tilt_shift', label: 'ç§»è»¸', en: 'Tilt-Shift', value: 'tilt-shift, miniature effect, selective blur', category: 'dof', icon: 'ğŸ ' },
                { id: 'soft_focus', label: 'æŸ”ç„¦', en: 'Soft Focus', value: 'soft focus, dreamy blur, romantic atmosphere', category: 'dof', icon: 'â˜ï¸' },
                { id: 'bokeh', label: 'æ•£æ™¯å…‰é»', en: 'Bokeh Lights', value: 'bokeh lights, hexagonal bokeh, creamy bokeh', category: 'dof', icon: 'âœ¨' },
                { id: 'fg_blur', label: 'å‰æ™¯è™›åŒ–', en: 'Foreground Blur', value: 'foreground blur, shooting through foreground elements, layered depth', category: 'dof', icon: 'ğŸŒ¿' },
                { id: 'center_focus', label: 'ä¸­å¤®å°ç„¦', en: 'Center Focus', value: 'center-focused, radial blur around edges', category: 'dof', icon: 'ğŸ¯' },

                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                // ğŸ–¼ï¸ æ§‹åœ–æŠ€å·§ (composition) â€” 8 items
                // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                { id: 'rule_thirds', label: 'ä¸‰åˆ†æ³•', en: 'Rule of Thirds', value: 'rule of thirds, subject at third intersection', category: 'composition', icon: '#ï¸âƒ£' },
                { id: 'centered', label: 'ä¸­å¿ƒæ§‹åœ–', en: 'Centered', value: 'centered composition, symmetrical framing', category: 'composition', icon: 'âŠ•' },
                { id: 'leading_lines', label: 'å¼•å°ç·š', en: 'Leading Lines', value: 'leading lines, converging lines guiding the eye', category: 'composition', icon: 'â†—ï¸' },
                { id: 'frame_in_frame', label: 'æ¡†ä¸­æ¡†', en: 'Frame in Frame', value: 'natural framing, framed by doorway, window framing subject', category: 'composition', icon: 'ğŸªŸ' },
                { id: 'negative_space', label: 'è² ç©ºé–“', en: 'Negative Space', value: 'negative space, minimalist composition, large empty area', category: 'composition', icon: 'â¬œ' },
                { id: 'golden_ratio', label: 'é»ƒé‡‘æ¯”ä¾‹', en: 'Golden Ratio', value: 'golden ratio composition, fibonacci framing', category: 'composition', icon: 'ğŸš' },
                { id: 'diagonal', label: 'å°è§’ç·š', en: 'Diagonal', value: 'diagonal composition, dynamic diagonal lines', category: 'composition', icon: 'â†™ï¸' },
                { id: 'layered', label: 'å‰ä¸­å¾Œæ™¯', en: 'Layered', value: 'layered composition: foreground, midground, background, depth layers', category: 'composition', icon: 'ğŸ“Š' }
            ],

            BONUS_TRAITS: {
                distance: [
                    { icon: 'ğŸŒ«ï¸', zh: 'å¤§æ°£é€è¦–', en: 'atmospheric haze, aerial perspective' },
                    { icon: 'ğŸŒ¿', zh: 'å‰æ™¯ç‰©ä»¶', en: 'foreground elements adding depth' },
                    { icon: 'ğŸ“', zh: 'åˆ†å±¤æ§‹åœ–', en: 'layered composition: foreground / midground / background' },
                    { icon: 'ğŸ”', zh: 'ä¸»é«”ä½”æ¯”æ§åˆ¶', en: 'character occupying 60% of frame height' },
                    { icon: 'ğŸ‘£', zh: 'è…³éƒ¨å¯è¦‹', en: 'feet visible, standing on surface' },
                    { icon: 'ğŸ”ï¸', zh: 'ç’°å¢ƒæ¸ºå°æ„Ÿ', en: 'dwarfed by the environment, insignificant against backdrop' }
                ],
                vAngle: [
                    { icon: 'ğŸ­', zh: 'æˆ²åŠ‡æ€§é€è¦–', en: 'dramatic perspective, foreshortening' },
                    { icon: 'ğŸ‘‘', zh: 'å¨åš´æ„Ÿ', en: 'imposing, powerful, dominant' },
                    { icon: 'ğŸ•Šï¸', zh: 'è„†å¼±æ„Ÿ', en: 'vulnerable, small, isolated' },
                    { icon: 'ğŸ“·', zh: 'ç›£æ§è¦–è§’', en: 'surveillance camera perspective' },
                    { icon: 'ğŸ¦¸', zh: 'è‹±é›„æ„Ÿ', en: 'heroic, monumental, impressive' },
                    { icon: 'ğŸŒŒ', zh: 'å…¨çŸ¥è¦–è§’', en: 'omniscient perspective, god view' }
                ],
                hAngle: [
                    { icon: 'ğŸ˜Š', zh: 'è‡ªç„¶è¡¨æƒ…', en: 'natural expression, candid feeling' },
                    { icon: 'ğŸ—¡ï¸', zh: 'é¢å°æ•µäºº', en: 'facing the enemy, confrontation' },
                    { icon: 'ğŸ¨', zh: 'è¼ªå»“å¼·èª¿', en: 'silhouette profile, contour lines' },
                    { icon: 'ğŸš¶', zh: 'èµ°å‘æœªçŸ¥', en: 'walking into the unknown, away from camera' },
                    { icon: 'ğŸ’«', zh: 'ä¸å®‰æ„Ÿ', en: 'disorienting, chaotic energy' },
                    { icon: 'ğŸ®', zh: 'æ²‰æµ¸æ„Ÿ', en: 'immersive, first-person experience' }
                ],
                movement: [
                    { icon: 'ğŸ’¨', zh: 'èƒŒæ™¯å‹•æ…‹æ¨¡ç³Š', en: 'motion blur in background' },
                    { icon: 'ğŸ¬', zh: 'é›»å½±æ„Ÿ', en: 'cinematic, dynamic perspective' },
                    { icon: 'ğŸ“°', zh: 'ç´€å¯¦æ„Ÿ', en: 'documentary feel, raw footage' },
                    { icon: 'ğŸŒ€', zh: 'æ—‹è½‰å‹•æ„Ÿ', en: 'rotational energy, spinning feel' },
                    { icon: 'âš¡', zh: 'é€Ÿåº¦æ„Ÿ', en: 'sense of speed, fast movement' },
                    { icon: 'ğŸ”', zh: 'æ­ç¤ºæ•ˆæœ', en: 'reveal effect, uncovering the scene' }
                ],
                lens: [
                    { icon: 'ğŸŒ¸', zh: 'å¥¶æ²¹æ•£æ™¯', en: 'creamy bokeh, smooth background blur' },
                    { icon: 'ğŸ“', zh: 'é€è¦–èª‡å¤§', en: 'exaggerated perspective, strong convergence' },
                    { icon: 'ğŸ—œï¸', zh: 'èƒŒæ™¯å£“ç¸®', en: 'compressed background, stacked layers' },
                    { icon: 'ğŸ”®', zh: 'æ¡¶ç‹€è®Šå½¢', en: 'barrel distortion, curved lines' },
                    { icon: 'ğŸ‘ï¸', zh: 'äººçœ¼è‡ªç„¶æ„Ÿ', en: 'natural human eye perspective' },
                    { icon: 'ğŸ”ï¸', zh: 'ç©ºé–“å±¤æ¬¡', en: 'spatial depth, dimensional layering' }
                ],
                dof: [
                    { icon: 'ğŸ’', zh: 'å…­è§’å½¢æ•£æ™¯', en: 'hexagonal bokeh shapes' },
                    { icon: 'ğŸŒˆ', zh: 'å…‰åœˆæ˜ŸèŠ’', en: 'starburst from small aperture, f/16' },
                    { icon: 'ğŸ§¸', zh: 'æ¨¡å‹æ„Ÿ', en: 'miniature model effect, toy-like' },
                    { icon: 'ğŸ’­', zh: 'å¤¢å¹»æœ¦æœ§', en: 'dreamy, ethereal, romantic haze' },
                    { icon: 'ğŸª', zh: 'æ•£æ™¯å…‰æšˆ', en: 'bokeh circles of confusion, light orbs' },
                    { icon: 'ğŸ“¸', zh: 'éŠ³åˆ©å…¨åŸŸ', en: 'tack sharp throughout, hyper-focused' }
                ],
                composition: [
                    { icon: 'â¡ï¸', zh: 'è¦–ç·šå¼•å°', en: 'eye guided through the frame' },
                    { icon: 'âš–ï¸', zh: 'è¦–è¦ºå¹³è¡¡', en: 'visual balance, harmonious weight' },
                    { icon: 'ğŸ­', zh: 'å¼µåŠ›æ„Ÿ', en: 'visual tension, dynamic energy' },
                    { icon: 'ğŸŒ€', zh: 'èºæ—‹æ§‹åœ–', en: 'golden spiral, fibonacci curve' },
                    { icon: 'ğŸª', zh: 'å°ç¨±ç¾å­¸', en: 'perfect symmetry, mirror composition' },
                    { icon: 'ğŸ“', zh: 'ç„¦é»çªå‡º', en: 'clear focal point, visual hierarchy' }
                ]
            }
        };

        // ================================================
        // State
        // ================================================
        let selectedItem = null;
        let selectedBonuses = new Map();
        let activeTab = 'all';
        let searchQuery = '';
        let recentIds = JSON.parse(localStorage.getItem('cmm_recent') || '[]');

        // ================================================
        // Open Modal
        // ================================================
        function openCameraModal() {
            const overlay = document.createElement('div');
            overlay.className = 'cmm-overlay';
            overlay.id = 'cameraModal';
            overlay.innerHTML = `
            <div class="cmm-flash"></div>
            <div class="cmm-magic-circle"></div>
            <div class="cmm-particles" id="cmmParticles"></div>
            <div class="cmm-container">
                <div class="cmm-dice-overlay" id="cmmDice">
                    <span class="cmm-dice-icon">ğŸ²</span>
                </div>
                <div class="cmm-header">
                    <div class="cmm-title-row">
                        <div class="cmm-title">ğŸ“¸ é«˜ç´šé­”æ³•ãƒ»é‹é¡å¤§å…¨</div>
                        <div class="cmm-toolbar">
                            <button onclick="randomPick()" title="éš¨æ©Ÿé¸å–"><i class="fa-solid fa-dice"></i> éš¨æ©Ÿ</button>
                            <button onclick="clearSelection()" title="æ¸…ç©º"><i class="fa-solid fa-eraser"></i></button>
                        </div>
                    </div>
                    <div class="cmm-search-row">
                        <i class="fa-solid fa-search"></i>
                        <input type="text" placeholder="æœå°‹é‹é¡ Search camera work..." oninput="onSearch(this.value)">
                    </div>
                </div>
                <div class="cmm-tabs" id="cmmTabs"></div>
                <div class="cmm-body" id="cmmBody"></div>
                <div class="cmm-bonus" id="cmmBonus">
                    <div class="cmm-bonus-title">â­ é»é¸å¢åŠ é‹é¡ç‰¹å¾µ â€”</div>
                    <div class="cmm-bonus-tags" id="cmmBonusTags"></div>
                </div>
                <div class="cmm-footer">
                    <div class="cmm-footer-status">
                        å·²é¸ï¼š<span class="count" id="cmmCount">0</span> é …
                    </div>
                    <div class="cmm-footer-actions">
                        <button class="cmm-btn cmm-btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                        <button class="cmm-btn cmm-btn-apply" onclick="applySelection()">âœ¨ å¥—ç”¨</button>
                    </div>
                </div>
            </div>
        `;
            document.body.appendChild(overlay);
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) closeModal();
            });
            spawnParticles();
            renderTabs();
            renderGrid();
        }

        // ================================================
        // Close Modal
        // ================================================
        function closeModal() {
            const overlay = document.getElementById('cameraModal');
            if (!overlay) return;
            overlay.classList.add('closing');
            setTimeout(() => overlay.remove(), 300);
        }

        // ================================================
        // Particles
        // ================================================
        function spawnParticles() {
            const container = document.getElementById('cmmParticles');
            if (!container) return;
            const colors = ['#22d3ee', '#a855f7', '#6366f1', '#ec4899', '#fbbf24', '#fff'];
            for (let i = 0; i < 30; i++) {
                const p = document.createElement('div');
                p.className = 'cmm-particle';
                p.style.left = Math.random() * 100 + '%';
                p.style.top = Math.random() * 100 + '%';
                p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                p.style.animationDelay = Math.random() * 6 + 's';
                p.style.animationDuration = (4 + Math.random() * 4) + 's';
                p.style.width = p.style.height = (2 + Math.random() * 4) + 'px';
                container.appendChild(p);
            }
        }

        // ================================================
        // Tabs
        // ================================================
        function renderTabs() {
            const container = document.getElementById('cmmTabs');
            if (!container) return;
            container.innerHTML = CAMERA_DATA.TABS.map(t =>
                `<div class="cmm-tab ${t.id === activeTab ? 'active' : ''}" onclick="switchTab('${t.id}')">
                ${t.icon} ${t.label}
            </div>`
            ).join('');
        }

        function switchTab(tabId) {
            activeTab = tabId;
            renderTabs();
            renderGrid();
        }

        // ================================================
        // Search
        // ================================================
        function onSearch(q) {
            searchQuery = q.trim().toLowerCase();
            renderGrid();
        }

        // ================================================
        // Get filtered items
        // ================================================
        function getFilteredItems() {
            let items = CAMERA_DATA.ITEMS;

            if (activeTab === 'recent') {
                items = recentIds.map(id => items.find(i => i.id === id)).filter(Boolean);
            } else if (activeTab === 'hot') {
                items = CAMERA_DATA.HOT_ITEMS.map(id => items.find(i => i.id === id)).filter(Boolean);
            } else if (activeTab !== 'all') {
                items = items.filter(i => i.category === activeTab);
            }

            if (searchQuery) {
                items = items.filter(i =>
                    i.label.includes(searchQuery) ||
                    i.en.toLowerCase().includes(searchQuery) ||
                    i.value.toLowerCase().includes(searchQuery)
                );
            }

            return items;
        }

        // ================================================
        // Render Grid
        // ================================================
        function renderGrid() {
            const body = document.getElementById('cmmBody');
            if (!body) return;
            const items = getFilteredItems();

            if (items.length === 0) {
                body.innerHTML = '<div class="cmm-empty">ğŸ” æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„é‹é¡æŠ€å·§</div>';
                return;
            }

            body.innerHTML = `<div class="cmm-grid">
            ${items.map(item => `
                <div class="cmm-chip ${selectedItem && selectedItem.id === item.id ? 'selected' : ''}"
                     onclick="selectItem('${item.id}')">
                    <span class="cmm-chip-icon">${item.icon}</span>
                    <div class="cmm-chip-text">
                        <span class="cmm-chip-zh">${item.label}</span>
                        <span class="cmm-chip-en">${item.en}</span>
                    </div>
                </div>
            `).join('')}
        </div>`;
        }

        // ================================================
        // Select Item
        // ================================================
        function selectItem(id) {
            const item = CAMERA_DATA.ITEMS.find(i => i.id === id);
            if (!item) return;

            if (selectedItem && selectedItem.id === id) {
                selectedItem = null;
                selectedBonuses.clear();
                hideBonus();
            } else {
                selectedItem = item;
                selectedBonuses.clear();
                showBonus(item.category);
            }

            renderGrid();
            updateCount();
        }

        // ================================================
        // Bonus Panel
        // ================================================
        function showBonus(category) {
            const panel = document.getElementById('cmmBonus');
            const container = document.getElementById('cmmBonusTags');
            if (!panel || !container) return;

            const traits = CAMERA_DATA.BONUS_TRAITS[category] || [];
            if (traits.length === 0) { hideBonus(); return; }

            container.innerHTML = traits.map(t =>
                `<span class="cmm-bonus-tag ${selectedBonuses.has(t.en) ? 'selected' : ''}"
                   onclick="toggleBonus('${t.en.replace(/'/g, "\\'")}', '${t.zh}')">
                ${t.icon} ${t.zh}
            </span>`
            ).join('');

            panel.classList.add('visible');
        }

        function hideBonus() {
            const panel = document.getElementById('cmmBonus');
            if (panel) panel.classList.remove('visible');
        }

        function toggleBonus(en, zh) {
            if (selectedBonuses.has(en)) {
                selectedBonuses.delete(en);
            } else {
                selectedBonuses.set(en, zh);
            }
            if (selectedItem) showBonus(selectedItem.category);
            updateCount();
        }

        // ================================================
        // Count
        // ================================================
        function updateCount() {
            const el = document.getElementById('cmmCount');
            if (el) el.textContent = (selectedItem ? 1 : 0) + selectedBonuses.size;
        }

        // ================================================
        // Random Pick
        // ================================================
        function randomPick() {
            const dice = document.getElementById('cmmDice');
            if (dice) {
                dice.classList.add('active');
                setTimeout(() => {
                    dice.classList.remove('active');
                    const items = CAMERA_DATA.ITEMS;
                    const rand = items[Math.floor(Math.random() * items.length)];
                    selectItem(rand.id);
                    // è‡ªå‹•é¸ä¸€å€‹bonus
                    const traits = CAMERA_DATA.BONUS_TRAITS[rand.category] || [];
                    if (traits.length > 0) {
                        const randTrait = traits[Math.floor(Math.random() * traits.length)];
                        if (!selectedBonuses.has(randTrait.en)) {
                            toggleBonus(randTrait.en, randTrait.zh);
                        }
                    }
                }, 800);
            }
        }

        // ================================================
        // Clear
        // ================================================
        function clearSelection() {
            selectedItem = null;
            selectedBonuses.clear();
            hideBonus();
            renderGrid();
            updateCount();
        }

        // ================================================
        // Apply
        // ================================================
        function applySelection() {
            if (!selectedItem) {
                closeModal();
                return;
            }

            // å„²å­˜åˆ° recent
            recentIds = [selectedItem.id, ...recentIds.filter(id => id !== selectedItem.id)].slice(0, 15);
            localStorage.setItem('cmm_recent', JSON.stringify(recentIds));

            // æ›´æ–° demo output
            const outputEl = document.getElementById('outputText');
            let prompt = `<span class="highlight">${selectedItem.value}</span>`;
            const bonusArr = [...selectedBonuses.keys()];
            if (bonusArr.length > 0) {
                prompt += ', ' + bonusArr.map(b => `<span class="bonus">${b}</span>`).join(', ');
            }
            outputEl.innerHTML = prompt;

            // æ›´æ–° summary bar
            const summary = document.getElementById('demoSummary');
            const tagsEl = document.getElementById('demoSummaryTags');
            summary.classList.add('visible');
            let tags = `<span class="demo-summary-tag main">${selectedItem.icon} ${selectedItem.label} ${selectedItem.en}</span>`;
            selectedBonuses.forEach((zh, en) => {
                tags += `<span class="demo-summary-tag bonus">âœ¨ ${zh}</span>`;
            });
            tagsEl.innerHTML = tags;

            closeModal();
        }

        // ================================================
        // Clear All (from demo page)
        // ================================================
        function clearAll() {
            selectedItem = null;
            selectedBonuses.clear();
            document.getElementById('demoSummary').classList.remove('visible');
            document.getElementById('outputText').innerHTML =
                '<span style="color: var(--text-secondary)">é»æ“Šä¸Šæ–¹æŒ‰éˆ•ï¼Œé¸æ“‡é‹é¡æŠ€å·§â€¦</span>';
        }
    </script>
</body>

</html>